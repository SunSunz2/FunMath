<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Math Blaster+!</title>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Fredoka One', cursive;
      background: linear-gradient(135deg, #cceeff, #e0f7ff);
      color: #003366;
      text-align: center;
      padding-top: 40px;
      margin: 0;
    }

    h1 {
      font-size: 40px;
      color: #0066cc;
      margin-bottom: 20px;
      text-shadow: 1px 2px 0 #fff;
    }

    #gameBox {
      background: white;
      border-radius: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      padding: 40px;
      max-width: 600px;
      margin: auto;
      display: none;
    }

    #question {
      font-size: 32px;
      margin: 20px 0;
      color: #004080;
    }

    .answers {
      display: flex;
      justify-content: center;
      gap: 20px;
      flex-wrap: wrap;
      margin-bottom: 30px;
    }

    .answer {
      background-color: #66ccff;
      border: none;
      border-radius: 20px;
      padding: 20px 30px;
      font-size: 24px;
      cursor: pointer;
      color: white;
      transition: 0.2s;
      box-shadow: 0 5px 10px rgba(0,0,0,0.2);
    }

    .answer:hover {
      background-color: #3399ff;
      transform: scale(1.1);
    }

    #score, #global-timer, #highscore {
      font-size: 20px;
      margin: 10px 0;
      color: #005580;
    }

    #gameover {
      color: red;
      font-size: 28px;
      margin-top: 20px;
      display: none;
    }

    #startScreen {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }

    #startButton, #muteButton {
      background-color: #66ccff;
      color: white;
      border: none;
      font-size: 24px;
      padding: 16px 32px;
      border-radius: 20px;
      cursor: pointer;
      box-shadow: 0 5px 10px rgba(0,0,0,0.2);
      transition: 0.2s;
      margin-top: 20px;
    }

    #startButton:hover, #muteButton:hover {
      background-color: #3399ff;
      transform: scale(1.05);
    }

    #muteButton {
      display: none;
    }
  </style>
</head>
<body>

  <div id="startScreen">
    <h1>ðŸŒŸ Math Blaster+! ðŸŒŸ</h1>
    <button id="startButton">Start Game</button>
  </div>

  <div id="gameBox">
    <div id="question">Loading...</div>
    <div class="answers" id="answers"></div>
    <div id="score">Score: 0</div>
    <div id="highscore">Highest Score: 0</div>
    <div id="global-timer">Time Left: 20</div>
    <div id="gameover">Game Over!</div>
    <button id="muteButton">ðŸ”Š Mute</button>
  </div>

  <audio id="bgMusic" loop>
    <source src="Mathfun.mp3" type="audio/mpeg">
  </audio>

  <script>
    let score = 0;
    let globalTime = 20;
    let globalTimerInterval;
    let highscore = parseInt(localStorage.getItem("mathHighScore")) || 0;

    const music = document.getElementById("bgMusic");
    const muteButton = document.getElementById("muteButton");

    muteButton.addEventListener("click", () => {
      if (music.paused) {
        music.play();
        muteButton.textContent = "ðŸ”Š Mute";
      } else {
        music.pause();
        muteButton.textContent = "ðŸ”‡ Unmute";
      }
    });

    function getRandomInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function getRandomProblem() {
      let ops = ['+', '-', '*', '/'];
      if (score < 5) ops = ['+', '-'];
      else if (score < 10) ops = ['+', '-', '*'];
      const op = ops[Math.floor(Math.random() * ops.length)];

      let a = getRandomInt(1, score + 5);
      let b = getRandomInt(1, score + 5);
      let question, answer;

      if (op === '+') {
        answer = a + b;
        question = `${a} + ${b}`;
      } else if (op === '-') {
        if (a < b) [a, b] = [b, a];
        answer = a - b;
        question = `${a} - ${b}`;
      } else if (op === '*') {
        answer = a * b;
        question = `${a} Ã— ${b}`;
      } else if (op === '/') {
        answer = a;
        b = getRandomInt(1, score + 3);
        a = answer * b;
        question = `${a} Ã· ${b}`;
      }

      return { question, answer };
    }

    function generateQuestion() {
      const { question, answer } = getRandomProblem();

      document.getElementById("question").textContent = question;
      const answers = new Set([answer]);
      while (answers.size < 4) {
        let wrong = answer + getRandomInt(-10, 10);
        if (wrong !== answer && wrong >= 0) answers.add(wrong);
      }

      const answerContainer = document.getElementById("answers");
      answerContainer.innerHTML = "";
      [...answers].sort(() => Math.random() - 0.5).forEach(num => {
        const btn = document.createElement("div");
        btn.className = "answer";
        btn.textContent = num;
        btn.onclick = () => {
          if (num === answer) {
            score++;
            globalTime += 5;
            document.getElementById("score").textContent = `Score: ${score}`;
            updateHighScore();
          } else {
            globalTime -= 3;
          }
          updateTimerDisplay();
          generateQuestion();
        };
        answerContainer.appendChild(btn);
      });
    }

    function updateTimerDisplay() {
      document.getElementById("global-timer").textContent = `Time Left: ${globalTime}`;
    }

    function updateHighScore() {
      if (score > highscore) {
        highscore = score;
        localStorage.setItem("mathHighScore", highscore);
        document.getElementById("highscore").textContent = `Highest Score: ${highscore}`;
      }
    }

    function gameOver() {
      clearInterval(globalTimerInterval);
      document.getElementById("gameover").style.display = "block";
      document.getElementById("question").textContent = "Game Over!";
      document.getElementById("answers").innerHTML = "";
    }

    function startGlobalTimer() {
      globalTimerInterval = setInterval(() => {
        globalTime--;
        updateTimerDisplay();
        if (globalTime <= 0) gameOver();
      }, 1000);
    }

    function startGame() {
      score = 0;
      globalTime = 20;
      document.getElementById("score").textContent = `Score: ${score}`;
      document.getElementById("highscore").textContent = `Highest Score: ${highscore}`;
      document.getElementById("gameover").style.display = "none";
      updateTimerDisplay();
      generateQuestion();
      startGlobalTimer();
    }

    document.getElementById("startButton").addEventListener("click", () => {
      document.getElementById("startScreen").style.display = "none";
      document.getElementById("gameBox").style.display = "block";
      muteButton.style.display = "inline-block";
      music.volume = 0.3;
      music.play();
      startGame();
    });
  </script>

</body>
</html>
